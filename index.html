<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" href="data:," />
    <title>AfterSchool Activities</title>
    <script src="https://cdn.jsdelivr.net/npm/vue@2.7.16/dist/vue.js"></script>
    <script src="products.js"></script>
    <link rel="stylesheet" href="style.css" />
    <script
      src="https://kit.fontawesome.com/e712731f30.js"
      crossorigin="anonymous"
    ></script>
  </head>
  <body>
    <div id="app">
      <header>
        <h1 v-text="sitename" v-on:click="showProducts"></h1>
        <input
          type="text"
          v-model="searchQuery"
          placeholder="Search products..."
          class="search-input"
        />
        <button v-on:click="showCheckout" :disabled="cart.length === 0">
          {{cartItemCount}}
          <span class="fa-solid fa-cart-shopping"></span>
          Checkout
        </button>
      </header>
      <main>
        <div class="product-grid" v-if="showProduct">
          <div id="individual-product" v-for="product in filteredProducts">
            <figure>
              <img v-bind:src="product.image" alt="" />
            </figure>
            <h2 v-text="product.title"></h2>
            <p v-text="product.description"></p>
            <p>Price: {{product.price}}</p>
            <p>
              Available Inventory: {{product.availableInventory -
              cartCount(product.id)}}
            </p>
            <button
              v-on:click="addToCart(product)"
              v-if="canAddToCart(product)"
            >
              Add to Cart
            </button>
            <button disabled="disabled" v-else>Add to cart</button>
            <span v-if="product.availableInventory === cartCount(product.id)">
              All out!</span
            >
            <span
              v-else-if="product.availableInventory - cartCount(product.id) < 5"
            >
              Only {{product.availableInventory - cartCount(product.id)}} left!
            </span>
            <span v-else> Buy Now!</span>
            <div id="rating">
              <span v-for="n in product.rating">★</span>
              <span v-for="n in 5-product.rating">☆</span>
            </div>
          </div>
        </div>
        <div v-else>
          <h2>CHECKOUT PAGE</h2>
          <!-- Cart Items Summary -->
          <h3>Your Cart:</h3>
          <div v-if="cart.length > 0">
            <ul>
              <li v-for="productId in uniqueCartItems">
                <span>{{ getProductTitle(productId) }}</span>
                - Price: {{ getProductPrice(productId) }} - Quantity: {{
                cartCount(productId) }}
                <button v-on:click="removeFromCart(productId)">Remove</button>
              </li>
            </ul>
          </div>
          <div v-else>
            <p>Your cart is empty.</p>
          </div>
          <p>
            <strong>Full Name:</strong>
            <input
              v-model.trim="order.fullName"
              @input="order.fullName = order.fullName.replace(/[^a-zA-Z\s]/g, '')"
              type="text"
            />
          </p>
          <p>
            <strong>Phone Number:</strong>
            <input
              v-model.trim="order.phone"
              type="tel"
              pattern="[0-9]*"
              placeholder="Enter only numbers"
              @input="order.phone = order.phone.replace(/[^0-9]/g, '')"
            />
          </p>
          <p>
            <strong>Country:</strong>
            <select v-model="order.country" class="form-control">
              <option v-for="country in countries" v-bind:value="country">
                {{country}}
              </option>
            </select>
          </p>
          <p>
            <strong>City:</strong>
            <input
              v-model.trim="order.city"
              type="text"
              @input="order.city = order.city.replace(/[^a-zA-Z\s]/g, '')"
            />
          </p>
          <p>
            <strong>Address:</strong>
            <input v-model="order.address" />
          </p>
          <p>
            <strong>Zip/Postal Code:</strong>
            <input v-model.number="order.zip" type="number" />
          </p>
          <p>
            <input
              type="checkbox"
              id="Gift"
              value="true"
              v-model="order.gift"
              v-bind:true-value="order.sendGift"
              v-bind:false-value="order.dontSendGift"
            />
            <label for="gift">Ship As Gift?</label>
          </p>
          <h2>Order Information</h2>
          <p>Full Name: {{order.fullName}}</p>
          <p>Contact Number: {{order.phone}}</p>
          <p>Country: {{order.country}}</p>
          <p>City: {{order.city}}</p>
          <p>Address: {{order.address}}</p>
          <p>Zip/Postal Code: {{order.zip}}</p>
          <p>Ship as gift: {{order.gift}}</p>
          <button v-on:click="submitForm" :disabled="!FormComplete">
            Place Order
          </button>
        </div>
      </main>
    </div>
    <script>
      var webstore = new Vue({
        el: "#app",
        data: {
          sitename: "AfterSchool Activities",
          showProduct: true,
          products: products,
          cart: [],
          searchQuery: "",
          order: {
            fullName: "",
            phone: "",
            address: "",
            city: "",
            zip: "",
            gift: false,
            dontSendGift: "Do not send as a gift",
            sendGift: "Send as a gift",
          },
          countries: [
            "Afghanistan",
            "Albania",
            "Algeria",
            "Andorra",
            "Angola",
            "Antigua and Barbuda",
            "Argentina",
            "Armenia",
            "Australia",
            "Austria",
            "Azerbaijan",
            "Bahamas",
            "Bahrain",
            "Bangladesh",
            "Barbados",
            "Belarus",
            "Belgium",
            "Belize",
            "Benin",
            "Bhutan",
            "Bolivia",
            "Bosnia and Herzegovina",
            "Botswana",
            "Brazil",
            "Brunei",
            "Bulgaria",
            "Burkina Faso",
            "Burundi",
            "Cabo Verde",
            "Cambodia",
            "Cameroon",
            "Canada",
            "Central African Republic",
            "Chad",
            "Chile",
            "China",
            "Colombia",
            "Comoros",
            "Congo",
            "Costa Rica",
            "Croatia",
            "Cuba",
            "Cyprus",
            "Czech Republic",
            "Democratic Republic of the Congo",
            "Denmark",
            "Djibouti",
            "Dominica",
            "Dominican Republic",
            "Ecuador",
            "Egypt",
            "El Salvador",
            "Equatorial Guinea",
            "Eritrea",
            "Estonia",
            "Eswatini",
            "Ethiopia",
            "Fiji",
            "Finland",
            "France",
            "Gabon",
            "Gambia",
            "Georgia",
            "Germany",
            "Ghana",
            "Greece",
            "Grenada",
            "Guatemala",
            "Guinea",
            "Guinea-Bissau",
            "Guyana",
            "Haiti",
            "Honduras",
            "Hungary",
            "Iceland",
            "India",
            "Indonesia",
            "Iran",
            "Iraq",
            "Ireland",
            "Israel",
            "Italy",
            "Jamaica",
            "Japan",
            "Jordan",
            "Kazakhstan",
            "Kenya",
            "Kiribati",
            "Korea, North",
            "Korea, South",
            "Kuwait",
            "Kyrgyzstan",
            "Laos",
            "Latvia",
            "Lebanon",
            "Lesotho",
            "Liberia",
            "Libya",
            "Liechtenstein",
            "Lithuania",
            "Luxembourg",
            "Madagascar",
            "Malawi",
            "Malaysia",
            "Maldives",
            "Mali",
            "Malta",
            "Marshall Islands",
            "Mauritania",
            "Mauritius",
            "Mexico",
            "Micronesia",
            "Moldova",
            "Monaco",
            "Mongolia",
            "Montenegro",
            "Morocco",
            "Mozambique",
            "Myanmar",
            "Namibia",
            "Nauru",
            "Nepal",
            "Netherlands",
            "New Zealand",
            "Nicaragua",
            "Niger",
            "Nigeria",
            "North Macedonia",
            "Norway",
            "Oman",
            "Pakistan",
            "Palau",
            "Palestine",
            "Panama",
            "Papua New Guinea",
            "Paraguay",
            "Peru",
            "Philippines",
            "Poland",
            "Portugal",
            "Qatar",
            "Romania",
            "Russia",
            "Rwanda",
            "Saint Kitts and Nevis",
            "Saint Lucia",
            "Saint Vincent and the Grenadines",
            "Samoa",
            "San Marino",
            "Sao Tome and Principe",
            "Saudi Arabia",
            "Senegal",
            "Serbia",
            "Seychelles",
            "Sierra Leone",
            "Singapore",
            "Slovakia",
            "Slovenia",
            "Solomon Islands",
            "Somalia",
            "South Africa",
            "South Sudan",
            "Spain",
            "Sri Lanka",
            "Sudan",
            "Suriname",
            "Sweden",
            "Switzerland",
            "Syria",
            "Taiwan",
            "Tajikistan",
            "Tanzania",
            "Thailand",
            "Timor-Leste",
            "Togo",
            "Tonga",
            "Trinidad and Tobago",
            "Tunisia",
            "Turkey",
            "Turkmenistan",
            "Tuvalu",
            "Uganda",
            "Ukraine",
            "United Arab Emirates",
            "United Kingdom",
            "United States",
            "Uruguay",
            "Uzbekistan",
            "Vanuatu",
            "Vatican City",
            "Venezuela",
            "Vietnam",
            "Yemen",
            "Zambia",
            "Zimbabwe",
          ],
        },
        methods: {
          showProducts() {
            this.showProduct = true;
          },
          addToCart(product) {
            this.cart.push(product.id);
          },
          canAddToCart(product) {
            return product.availableInventory > this.cartCount(product.id);
          },
          removeFromCart(productId) {
            const index = this.cart.lastIndexOf(productId); // Find the last occurrence of the productId
            if (index > -1) {
              this.cart.splice(index, 1); // Remove one occurrence of the productId
            }
          },
          submitForm() {
            {
              alert("Order submitted");
            }
          },
          cartCount(id) {
            let count = 0;
            for (let i = 0; i < this.cart.length; i++) {
              if (this.cart[i] === id) {
                count++;
              }
            }
            return count;
          },
          showCheckout() {
            this.showProduct = this.showProduct ? false : true;
          },
          getProductTitle(productId) {
            const product = this.products.find((p) => p.id === productId);
            return product ? product.title : "Not a Product";
          },
          getProductPrice(productId) {
            const product = this.products.find((p) => p.id === productId);
            return product ? product.price : "Not a Product";
          },
        },
        computed: {
          cartItemCount: function () {
            return this.cart.length;
          },
          sortedProducts() {
            function compare(a, b) {
              if (a.price > b.price) return -1;
              if (a.price < b.price) return 1;
              return 0;
            }
            return this.products.sort(compare);
          },
          uniqueCartItems() {
            return [...new Set(this.cart)]; //Set object removes all duplicate values so if a product is selected twice it won't appear twice with all the deets just one line with quantity set as 2
          },
          FormComplete() {
            return (
              this.order.fullName.trim() !== "" &&
              this.order.phone.trim() !== "" &&
              this.order.address.trim() !== "" &&
              this.order.city.trim() !== "" &&
              this.order.zip !== "" &&
              this.order.country !== ""
            );
          },
          filteredProducts() {
            return this.sortedProducts.filter((product) => {
              const query = this.searchQuery.toLowerCase();
              return (
                product.title.toLowerCase().includes(query) ||
                product.price.toString().includes(query) // Convert price to string to allow text-based matching
              );
            });
          },
        },
      });
    </script>
  </body>
</html>